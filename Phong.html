<html>
  <head>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script>
      AFRAME.registerShader('my-custom', {
        schema: {
          color: {
            type: 'color',
            is: 'uniform',
            default: 'red'
          },
          opacity: {
            type: 'number',
            is: 'uniform',
            default: 1.0
          },
					lightPos: {
            type: 'vec3',
            is: 'uniform',
            default: '1 1 1'
          },
        },
        raw: false,
        vertexShader: `
						varying vec2 vUv;
						varying vec3 vNormal;
						varying vec3 vFragPos;
						
						void main() {
							vNormal = normal;
							vFragPos = position;
							gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
						}
					`,
					
        fragmentShader: `
					precision mediump float;
					varying vec3 vNormal;
					varying vec3 vFragPos;
				
					uniform vec3 color;
					uniform float opacity;
					uniform vec3 lightPos;
					
					void main () {
						vec3 ambient = 0.05*color;
						vec3 lightDir = normalize(lightPos - vFragPos);
						vec3 normal = normalize(vNormal);
						
						float diff = max(dot(lightDir, normal), 0.0);
    				vec3 diffuse = diff * color;
						
						vec3 viewDir = normalize(cameraPosition - vFragPos);
    				vec3 reflectDir = reflect(-lightDir, normal);
    				float spec = 0.0;
						//vec3 halfwayDir = normalize(lightDir + viewDir);  
        		//spec = pow(max(dot(normal, halfwayDir), 0.0), 32.0);
						
        		spec = pow(max(dot(cameraPosition, reflectDir), 0.0), 8.0);
						vec3 specular = vec3(0.3) * spec;
						
    				gl_FragColor = vec4(ambient + diffuse + specular, 1.0);
					}
				`
      });

    </script>
  </head>

  <body>
    <a-scene background="transparent:true">
      <a-assets>

      </a-assets>

      <a-entity light="type:point; castShadow:true" rotation="40 0 0" position="0 4 2"></a-entity>

      <a-entity id="rig" position="0 0.7 -1">
        <a-entity camera look-controls wasd-controls="acceleration:100"></a-entity>
      </a-entity>

      <a-box material="shader: my-custom; color: blue; opacity: 1; lightPos:'0 4 2' transparent: true" position="0 0 -2"></a-box>

    </a-scene>
  </body>

</html>
